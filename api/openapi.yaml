openapi: 3.0.3
info:
  title: Movarisch API
  version: 1.0.0
  description: |
    Specifica OpenAPI per le API backend PHP di Movarisch.
    Gli endpoint sono registrati in `api/action.php`.
servers:
  - url: /api/action.php
    description: Base path predefinito del backend
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ApiError:
      type: object
      properties:
        code:
          type: string
          example: VALIDATION_ERROR
        message:
          type: string
          example: Campo obbligatorio mancante
        details:
          type: object
          additionalProperties: true
      required:
        - code
        - message
      additionalProperties: false
    ErrorMessage:
      type: object
      properties:
        message:
          type: string
      required:
        - message
    AuthFailure:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
      required:
        - success
        - message
    LoginRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required:
        - username
        - password
    UserRole:
      type: string
      enum:
        - ADMIN
        - USER
    User:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        mail:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        surname:
          type: string
          nullable: true
        roles:
          type: array
          items:
            $ref: '#/components/schemas/UserRole'
        isActive:
          type: boolean
          default: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - username
        - roles
        - isActive
        - createdAt
        - updatedAt
      additionalProperties: false
    TokenResponse:
      type: object
      properties:
        accessToken:
          type: string
        tokenType:
          type: string
          example: Bearer
        expiresIn:
          type: integer
          example: 3600
        user:
          $ref: '#/components/schemas/User'
      required:
        - accessToken
        - tokenType
        - expiresIn
        - user
      additionalProperties: false
    LoginResponse:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        mail:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        surname:
          type: string
          nullable: true
        password:
          type: string
          nullable: true
          description: Nel login viene restituita come null.
        roles:
          type: array
          items:
            type: string
        token:
          type: string
      required:
        - roles
        - token
    VerifyTokenRequest:
      type: object
      properties:
        token:
          type: string
      required:
        - token
    UserSelfUpdate:
      type: object
      properties:
        mail:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        surname:
          type: string
          nullable: true
      additionalProperties: false
    ChangePasswordRequest:
      type: object
      properties:
        oldPassword:
          type: string
        newPassword:
          type: string
          minLength: 8
      required:
        - oldPassword
        - newPassword
      additionalProperties: false
    UserBase:
      type: object
      properties:
        id:
          type: integer
        mail:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        surname:
          type: string
          nullable: true
        username:
          type: string
          nullable: true
        password:
          type: string
          nullable: true
        roles:
          type: string
          nullable: true
    UserWithRoles:
      allOf:
        - $ref: '#/components/schemas/UserBase'
        - type: object
          properties:
            roles:
              type: array
              items:
                type: string
    UserAdminCreate:
      type: object
      properties:
        mail:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        password:
          type: string
        surname:
          type: string
          nullable: true
        username:
          type: string
        roles:
          type: array
          items:
            type: string
      required:
        - password
        - username
        - roles
    UserAdminUpdate:
      type: object
      properties:
        mail:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        surname:
          type: string
          nullable: true
        roles:
          type: array
          items:
            type: string
    FrasiH:
      type: object
      properties:
        id:
          type: integer
        Codice:
          type: string
        Descrizione:
          type: string
        Punteggio:
          type: number
          format: float
      required:
        - Codice
        - Descrizione
        - Punteggio
    Sostanza:
      type: object
      properties:
        id:
          type: integer
        Identificativo:
          type: string
        Nome:
          type: string
        Score:
          type: number
          format: float
        VLEP:
          type: boolean
        User:
          type: integer
        FrasiH:
          type: array
          items:
            type: integer
      required:
        - Identificativo
        - Nome
        - Score
        - VLEP
        - User
        - FrasiH
    AgenteChimicoTipo:
      type: string
      enum:
        - sostanza
        - miscelaP
        - miscelaNP
        - processo
    AgenteChimicoBase:
      type: object
      properties:
        id:
          type: integer
        nome:
          type: string
        identificativo:
          type: string
        vlep:
          type: boolean
        alta_emissione:
          type: boolean
        tipo:
          $ref: '#/components/schemas/AgenteChimicoTipo'
        frasiHIds:
          type: array
          items:
            type: integer
      required:
        - id
        - nome
        - identificativo
        - vlep
        - alta_emissione
        - tipo
      additionalProperties: false
    AgenteChimicoSostanza:
      allOf:
        - $ref: '#/components/schemas/AgenteChimicoBase'
        - type: object
          properties:
            tipo:
              type: string
              enum:
                - sostanza
          additionalProperties: false
    AgenteChimicoComposto:
      allOf:
        - $ref: '#/components/schemas/AgenteChimicoBase'
        - type: object
          properties:
            tipo:
              type: string
              enum:
                - miscelaP
                - miscelaNP
                - processo
            sostanzeComponentiIds:
              type: array
              items:
                type: integer
          required:
            - sostanzeComponentiIds
          additionalProperties: false
    AgenteChimico:
      oneOf:
        - $ref: '#/components/schemas/AgenteChimicoSostanza'
        - $ref: '#/components/schemas/AgenteChimicoComposto'
      discriminator:
        propertyName: tipo
    AgenteChimicoCreateBase:
      type: object
      properties:
        nome:
          type: string
        identificativo:
          type: string
        vlep:
          type: boolean
        alta_emissione:
          type: boolean
        tipo:
          $ref: '#/components/schemas/AgenteChimicoTipo'
        frasiHIds:
          type: array
          items:
            type: integer
      required:
        - nome
        - identificativo
        - vlep
        - alta_emissione
        - tipo
      additionalProperties: false
    AgenteChimicoCreateSostanza:
      allOf:
        - $ref: '#/components/schemas/AgenteChimicoCreateBase'
        - type: object
          properties:
            tipo:
              type: string
              enum:
                - sostanza
          additionalProperties: false
    AgenteChimicoCreateComposto:
      allOf:
        - $ref: '#/components/schemas/AgenteChimicoCreateBase'
        - type: object
          properties:
            tipo:
              type: string
              enum:
                - miscelaP
                - miscelaNP
                - processo
            sostanzeComponentiIds:
              type: array
              items:
                type: integer
          required:
            - sostanzeComponentiIds
          additionalProperties: false
    AgenteChimicoCreate:
      oneOf:
        - $ref: '#/components/schemas/AgenteChimicoCreateSostanza'
        - $ref: '#/components/schemas/AgenteChimicoCreateComposto'
      discriminator:
        propertyName: tipo
    AgenteChimicoUpdateSostanza:
      type: object
      properties:
        nome:
          type: string
        identificativo:
          type: string
        vlep:
          type: boolean
        alta_emissione:
          type: boolean
        frasiHIds:
          type: array
          items:
            type: integer
      additionalProperties: false
    AgenteChimicoUpdateComposto:
      type: object
      properties:
        nome:
          type: string
        identificativo:
          type: string
        vlep:
          type: boolean
        alta_emissione:
          type: boolean
        frasiHIds:
          type: array
          items:
            type: integer
        sostanzeComponentiIds:
          type: array
          items:
            type: integer
      additionalProperties: false
    CalcoloValutazioneRequest:
      type: object
      properties:
        lavoratoreId:
          type: integer
        agenteChimicoId:
          type: integer
        metodoVersione:
          type: string
        einal:
          type: number
          format: float
          nullable: true
        statoFisicoInal:
          type: integer
          nullable: true
        quantitaKg:
          type: number
          format: float
          nullable: true
        tipoUsoInal:
          type: integer
          nullable: true
        tipoControlloInal:
          type: integer
          nullable: true
        tempoInalMin:
          type: integer
          nullable: true
        distanzaM:
          type: number
          format: float
          nullable: true
        ecute:
          type: number
          format: float
          nullable: true
        esposizioneCutanea:
          type: boolean
          nullable: true
        livelliContattoCutaneo:
          type: integer
          nullable: true
        tipoControlloProc:
          type: integer
          nullable: true
        quantitaProcKg:
          type: number
          format: float
          nullable: true
        tempoProcMin:
          type: integer
          nullable: true
      required:
        - lavoratoreId
        - agenteChimicoId
        - metodoVersione
      additionalProperties: false
    CalcoloValutazioneByIdRequest:
      type: object
      properties:
        metodoVersione:
          type: string
      required:
        - metodoVersione
      additionalProperties: false
    CalcoloValutazioneResponse:
      type: object
      properties:
        metodoVersione:
          type: string
        rInal:
          type: number
          format: float
        rCute:
          type: number
          format: float
        rischioCumulativo:
          type: number
          format: float
        warnings:
          type: array
          items:
            type: string
      required:
        - metodoVersione
        - rInal
        - rCute
        - rischioCumulativo
      additionalProperties: false
paths:
  /login:
    post:
      summary: Autentica un utente e restituisce un JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Utente autenticato con token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Credenziali non valide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
  /auth/login:
    post:
      summary: Login (JWT) nuovo formato risposta
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /auth/me:
    get:
      summary: Ritorna l'utente autenticato
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /verifyToken:
    post:
      summary: Verifica un token JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyTokenRequest'
      responses:
        '200':
          description: Token valido
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '401':
          description: Token non valido
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthFailure'
        '403':
          description: Token mancante
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthFailure'
  /users/me:
    patch:
      summary: Aggiorna solo il proprio profilo
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserSelfUpdate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /users/me/change-password:
    post:
      summary: Cambio password del proprio utente
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '204':
          description: Password cambiata
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /admin/users:
    get:
      summary: Lista utenti (solo ADMIN)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    post:
      summary: Crea utente (solo ADMIN)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserAdminCreate'
      responses:
        '201':
          description: Creato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /admin/users/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Dettaglio utente (solo ADMIN)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    patch:
      summary: Aggiorna utente (solo ADMIN)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserAdminUpdate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    delete:
      summary: Elimina utente (solo ADMIN)
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Eliminato
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /Users/:
    get:
      summary: Lista utenti con ruoli
      responses:
        '200':
          description: Lista utenti
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserWithRoles'
    post:
      summary: Crea un utente e associa ruoli
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserAdminCreate'
      responses:
        '200':
          description: Echo del body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserAdminCreate'
  /Users/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Recupera un utente con ruoli
      responses:
        '200':
          description: Utente trovato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserWithRoles'
    post:
      summary: Aggiorna anagrafica utente e ruoli
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserAdminUpdate'
      responses:
        '200':
          description: Echo del body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserAdminUpdate'
    delete:
      summary: Elimina un utente e rimuove i ruoli associati
      responses:
        '200':
          description: Esito eliminazione
          content:
            application/json:
              schema:
                type: boolean
  /frasih:
    get:
      summary: Lista tutte le FrasiH
      responses:
        '200':
          description: Lista FrasiH
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FrasiH'
    post:
      summary: Crea una FrasiH
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FrasiH'
      responses:
        '200':
          description: Echo del body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FrasiH'
  /frasih/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Recupera una FrasiH per ID
      responses:
        '200':
          description: FrasiH trovata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FrasiH'
    post:
      summary: Aggiorna una FrasiH
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FrasiH'
      responses:
        '200':
          description: Echo del body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FrasiH'
    delete:
      summary: Elimina una FrasiH
      responses:
        '200':
          description: Esito eliminazione
          content:
            application/json:
              schema:
                type: boolean
  /sostanza:
    get:
      summary: Lista tutte le Sostanze
      responses:
        '200':
          description: Lista sostanze
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Sostanza'
    post:
      summary: Crea una Sostanza e gestisce la relazione con FrasiH
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Sostanza'
      responses:
        '200':
          description: Echo del body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sostanza'
  /sostanza/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Recupera una Sostanza e aggiunge l'array FrasiH dai join
      responses:
        '200':
          description: Sostanza trovata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sostanza'
    post:
      summary: Aggiorna una Sostanza e riallinea la relazione con FrasiH
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Sostanza'
      responses:
        '200':
          description: Echo del body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sostanza'
    delete:
      summary: Elimina una Sostanza
      responses:
        '200':
          description: Esito eliminazione
          content:
            application/json:
              schema:
                type: boolean
  /sostanza/findByFrasiH/{key}:
    parameters:
      - name: key
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Filtra Sostanza per chiave FrasiH
      responses:
        '200':
          description: Lista sostanze filtrate
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Sostanza'
  /sostanza/findByUser/{key}:
    parameters:
      - name: key
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Filtra Sostanza per User
      responses:
        '200':
          description: Lista sostanze filtrate
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Sostanza'
  /sostanza/findByVLEP/{key}:
    parameters:
      - name: key
        in: path
        required: true
        schema:
          type: boolean
    get:
      summary: Filtra Sostanza per flag VLEP
      responses:
        '200':
          description: Lista sostanze filtrate
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Sostanza'
  /calcoli/valutazioni:
    post:
      summary: Calcolo valutazione (stateless)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalcoloValutazioneRequest'
      responses:
        '200':
          description: Esito calcolo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalcoloValutazioneResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /calcoli/valutazioni/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    post:
      summary: Calcolo valutazione salvata (stateless)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalcoloValutazioneByIdRequest'
      responses:
        '200':
          description: Esito calcolo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalcoloValutazioneResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /agenti-chimici:
    get:
      summary: Lista agenti chimici
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista agenti chimici
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AgenteChimico'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    post:
      summary: Crea agente chimico
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgenteChimicoCreate'
      responses:
        '201':
          description: Creato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgenteChimico'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /agenti-chimici/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Dettaglio agente chimico
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgenteChimico'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    patch:
      summary: Aggiorna agente chimico
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/AgenteChimicoUpdateSostanza'
                - $ref: '#/components/schemas/AgenteChimicoUpdateComposto'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgenteChimico'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
    delete:
      summary: Elimina agente chimico
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Eliminato
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
  /user:
    get:
      summary: Lista utenti base
      responses:
        '200':
          description: Lista utenti base
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserBase'
    post:
      summary: Crea un utente base
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBase'
      responses:
        '200':
          description: Echo del body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBase'
  /user/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Recupera un utente base
      responses:
        '200':
          description: Utente trovato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBase'
    post:
      summary: Aggiorna un utente base
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBase'
      responses:
        '200':
          description: Echo del body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBase'
    delete:
      summary: Elimina un utente base
      responses:
        '200':
          description: Esito eliminazione
          content:
            application/json:
              schema:
                type: boolean
  /user/{id}/changePassword:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
    post:
      summary: Stub cambio password (ritorna ok)
      responses:
        '200':
          description: Risposta di servizio
          content:
            application/json:
              schema:
                type: string
                example: ok
